// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Appartamenti
model Appartamento {
  id             Int           @id @default(autoincrement())
  nome           String
  slug           String        @unique
  descrizione    String?
  postiLetto     Int
  camere         Int
  bagni          Int
  piano          String?
  airbnbId       String?
  bookingId      String?
  attivo         Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  prenotazioni   Prenotazione[]
  periodiPrezzo  PeriodoPrezzo[]
  blocchi        BloccoCalendario[]
}

// Periodi prezzo
model PeriodoPrezzo {
  id              Int          @id @default(autoincrement())
  appartamentoId  Int
  nome            String
  dataInizio      DateTime
  dataFine        DateTime
  prezzoSettimana Int
  prezzoNotte     Int
  minNotti        Int          @default(7)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  appartamento    Appartamento @relation(fields: [appartamentoId], references: [id], onDelete: Cascade)
}

// Ospiti
model Ospite {
  id              Int           @id @default(autoincrement())
  nome            String
  cognome         String
  email           String?
  telefono        String?
  codiceFiscale   String?
  indirizzo       String?
  citta           String?
  cap             String?
  provincia       String?
  nazione         String        @default("Italia")
  documentoTipo   String?
  documentoNumero String?
  note            String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  prenotazioni    Prenotazione[]
}

// Prenotazioni
model Prenotazione {
  id                  Int           @id @default(autoincrement())
  appartamentoId      Int
  ospiteId            Int

  checkIn             DateTime
  checkOut            DateTime

  numAdulti           Int           @default(2)
  numBambini          Int           @default(0)
  numNeonati          Int           @default(0)

  animali             Boolean       @default(false)
  animaliDettaglio    String?

  biancheria          Boolean       @default(false)
  bianchieriaSets     Int           @default(0)
  biancheriaCosto     Float         @default(0)

  prezzoSoggiorno     Float
  prezzoExtra         Float         @default(0)
  tassaSoggiorno      Float         @default(0)
  totale              Float

  acconto             Float         @default(0)
  accontoData         DateTime?
  accontoPagato       Boolean       @default(false)
  saldo               Float         @default(0)
  saldoData           DateTime?
  saldoPagato         Boolean       @default(false)

  cauzione            Float         @default(200)
  cauzioneIncassata   Boolean       @default(false)
  cauzioneRestituita  Boolean       @default(false)
  cauzioneNote        String?

  stato               String        @default("pending")
  fonte               String        @default("direct")
  fonteRiferimento    String?

  noteInterne         String?
  noteOspite          String?
  richiesteSpeciali   String?

  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt

  appartamento        Appartamento  @relation(fields: [appartamentoId], references: [id])
  ospite              Ospite        @relation(fields: [ospiteId], references: [id])
  pagamenti           Pagamento[]
  spese               Spesa[]
}

// Pagamenti
model Pagamento {
  id              Int           @id @default(autoincrement())
  prenotazioneId  Int
  importo         Float
  tipo            String
  metodo          String
  data            DateTime
  riferimento     String?
  note            String?
  createdAt       DateTime      @default(now())

  prenotazione    Prenotazione  @relation(fields: [prenotazioneId], references: [id], onDelete: Cascade)
}

// Spese
model Spesa {
  id              Int           @id @default(autoincrement())
  prenotazioneId  Int?
  categoria       String
  descrizione     String
  importo         Float
  data            DateTime
  fornitore       String?
  fattura         String?
  pagato          Boolean       @default(false)
  note            String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  prenotazione    Prenotazione? @relation(fields: [prenotazioneId], references: [id], onDelete: SetNull)
}

// Blocchi calendario
model BloccoCalendario {
  id              Int           @id @default(autoincrement())
  appartamentoId  Int
  dataInizio      DateTime
  dataFine        DateTime
  motivo          String?
  note            String?
  createdAt       DateTime      @default(now())

  appartamento    Appartamento  @relation(fields: [appartamentoId], references: [id], onDelete: Cascade)
}

// Task
model Task {
  id              Int           @id @default(autoincrement())
  titolo          String
  descrizione     String?
  priorita        String        @default("medium")
  stato           String        @default("pending")
  categoria       String        @default("generale")
  appartamentoId  Int?
  prenotazioneId  Int?
  scadenza        DateTime?
  completatoIl    DateTime?
  assegnatoA      String?
  note            String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

// Impostazioni
model Impostazione {
  id        Int      @id @default(autoincrement())
  chiave    String   @unique
  valore    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Entrate
model Entrata {
  id          Int      @id @default(autoincrement())
  descrizione String
  importo     Float
  categoria   String
  data        DateTime
  riferimento String?
  note        String?
  createdAt   DateTime @default(now())
}

// Pulizie
model Pulizia {
  id              Int           @id @default(autoincrement())
  appartamentoId  Int
  data            DateTime
  orarioCheckout  String?
  tipo            String
  stato           String        @default("da_fare")
  prenotazioneId  Int?
  note            String?
  completataIl    DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

// Storico stagioni
model StagioneStorico {
  id                    Int      @id @default(autoincrement())
  anno                  Int      @unique
  ricaviTotali          Float
  prenotazioniTotali    Int
  ricavoMedio           Float
  ricaviPerMese         String
  prenotazioniPerMese   String
  datiPerAppartamento   String
  ricaviPerFonte        String?
  ricaviPerNazionalita  String?
  durataMediaSoggiorno  Float?
  tassoOccupazione      Float?
  note                  String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}
